# å…è²»è©¦ç”¨ 7 å¤©åŠŸèƒ½ - å¯¦ä½œ Todo æ¸…å–®

## Phase 1: MVP - è©¦ç”¨ç³»çµ±ï¼ˆ3-4 å·¥ä½œæ—¥ï¼‰

### è³‡æ–™åº«å±¤

- [x] **1.1** å»ºç«‹ migration æª”æ¡ˆ `docs/migration_trial_system.sql`
  - [x] å»ºç«‹ `coupons` è¡¨ï¼ˆä¸å« `partner_id`ï¼ŒPhase 2 å†æ–°å¢ï¼‰
  - [x] å»ºç«‹ `coupon_usages` è¡¨
  - [x] æ“´å…… `users` è¡¨ï¼ˆtrial_activated_at, trial_source, trial_usedï¼‰
  - [x] åŸ·è¡Œ migration é©—è­‰

### API å±¤ - æŠ˜æ‰£ç¢¼é©—è­‰

- [x] **2.1** å»ºç«‹ `src/lib/coupons/constants.ts`
  - [x] å®šç¾©æŠ˜æ‰£ç¢¼æ ¼å¼è¦å‰‡
  - [x] å®šç¾©éŒ¯èª¤è¨Šæ¯å¸¸æ•¸

- [x] **2.2** å»ºç«‹ `src/lib/coupons/validation.ts`
  - [x] å¯¦ä½œ `validateCoupon()` å‡½æ•¸
  - [x] æª¢æŸ¥æŠ˜æ‰£ç¢¼å­˜åœ¨æ€§
  - [x] æª¢æŸ¥æœ‰æ•ˆæœŸé™
  - [x] æª¢æŸ¥ä½¿ç”¨æ¬¡æ•¸é™åˆ¶
  - [x] æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å·²ä½¿ç”¨
  - [x] æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å·²ç”¨éè©¦ç”¨

- [x] **2.3** å»ºç«‹ `src/app/api/coupons/validate/route.ts`
  - [x] å¯¦ä½œ POST ç«¯é»
  - [x] å‘¼å« validateCoupon()
  - [x] è¿”å›é©—è­‰çµæœ

### API å±¤ - é˜²æ¿«ç”¨

- [x] **2.4** å»ºç«‹ `src/lib/coupons/antiAbuse.ts`
  - [x] IP é™åˆ¶é‚è¼¯ï¼ˆ24h å…§é™ 3 æ¬¡ï¼‰
  - [x] Email domain é»‘åå–®æª¢æŸ¥
  - [x] è³‡æ–™åº« UNIQUE ç´„æŸé©—è­‰

### API å±¤ - æŠ˜æ‰£ç¢¼å…Œæ›

- [x] **2.5** å»ºç«‹ `src/app/api/coupons/redeem/route.ts`
  - [x] JWT é©—è­‰
  - [x] å‘¼å« validateCoupon()
  - [x] é˜²æ¿«ç”¨æª¢æŸ¥
  - [x] é–‹å•Ÿ Transactionï¼š
    - [x] æ›´æ–° users è¡¨
    - [x] æ’å…¥ coupon_usages è¨˜éŒ„
    - [x] æ›´æ–° coupons.used_count
    - [x] æ’å…¥ payments è¨˜éŒ„ï¼ˆamount=0ï¼‰
  - [x] ç™¼é€åˆ†æäº‹ä»¶
  - [x] éŒ¯èª¤è™•ç†

### API å±¤ - Cron Job

- [x] **2.6** å»ºç«‹ `src/app/api/cron/expire-trials/route.ts`
  - [x] CRON_SECRET é©—è­‰
  - [x] æŸ¥è©¢éæœŸè©¦ç”¨ç”¨æˆ¶
  - [x] æ‰¹æ¬¡é™ç´šç‚ºå…è²»ç‰ˆ
  - [ ] ç™¼é€åˆ°æœŸ Emailï¼ˆå¯é¸ï¼‰
  - [x] è¨˜éŒ„åˆ†æäº‹ä»¶

### å‰ç«¯å±¤ - çµ„ä»¶

- [x] **3.1** å»ºç«‹ `src/components/CouponBanner.tsx`
  - [x] é¡¯ç¤ºåˆä½œæ–¹åç¨±
  - [x] é¡¯ç¤ºæŠ˜æ‰£ç¢¼
  - [x] ã€Œç«‹å³å•Ÿç”¨å…è²»è©¦ç”¨ã€æŒ‰éˆ•
  - [x] èªªæ˜æ–‡å­—
  - [x] CSS æ¨£å¼ï¼ˆç¶ è‰²æ¼¸å±¤ä¸»é¡Œï¼‰

- [x] **3.2** å»ºç«‹ `src/app/trial-success/page.tsx`
  - [x] æˆåŠŸæç¤º UI
  - [x] é¡¯ç¤ºè©¦ç”¨åˆ°æœŸæ™‚é–“
  - [x] ã€Œé–‹å§‹å­¸ç¿’ã€æŒ‰éˆ•
  - [x] ã€ŒæŸ¥çœ‹å®Œæ•´æ–¹æ¡ˆã€é€£çµ

### å‰ç«¯å±¤ - Pricing é é¢æ•´åˆ

- [x] **3.3** ä¿®æ”¹ `src/app/pricing/page.tsx`
  - [x] è®€å– URL åƒæ•¸ `?coupon=XXX`
  - [x] å‘¼å« `/api/coupons/validate`
  - [x] æ ¹æ“šçµæœé¡¯ç¤º/éš±è— CouponBanner
  - [x] è™•ç†ã€Œå•Ÿç”¨è©¦ç”¨ã€æŒ‰éˆ•é»æ“Š
  - [x] æª¢æŸ¥ç™»å…¥ç‹€æ…‹
  - [x] æœªç™»å…¥æ™‚è·³è½‰ï¼ˆä¿ç•™ coupon åƒæ•¸ï¼‰
  - [x] å·²ç™»å…¥æ™‚å‘¼å« `/api/coupons/redeem`
  - [x] æˆåŠŸå¾Œé‡å®šå‘åˆ° `/trial-success`
  - [x] éŒ¯èª¤æç¤º

### TypeScript é¡å‹

- [x] **4.1** å»ºç«‹ `src/types/coupon.ts`
  - [x] å®šç¾© Coupon ä»‹é¢
  - [x] å®šç¾© CouponValidationResult ä»‹é¢
  - [x] å®šç¾© CouponRedeemResult ä»‹é¢

### é…ç½®

- [x] **5.1** ä¿®æ”¹ `vercel.json`
  - [x] æ–°å¢ `/api/cron/expire-trials` Cron ä»»å‹™
  - [x] è¨­å®šæ™‚é–“è¡¨ï¼ˆæ¯æ—¥å‡Œæ™¨ 2 é»ï¼‰

### æ¸¬è©¦

- [x] **6.1** æ‰‹å‹•æ¸¬è©¦ Checklist
  - [x] URL åƒæ•¸æ­£ç¢ºå‚³é âœ… (HTTP 200)
  - [x] æœªç™»å…¥ç”¨æˆ¶å¯çœ‹åˆ°æ©«å¹…ä½†ç„¡æ³•å…Œæ› âœ… (validate æˆåŠŸï¼Œredeem è¦æ±‚ç™»å…¥)
  - [x] ç™»å…¥å¾Œè‡ªå‹•å…Œæ›ä¸¦é‡å®šå‘åˆ°æˆåŠŸé é¢ âœ… (æ–°ç”¨æˆ¶æˆåŠŸå…Œæ›)
  - [x] è©¦ç”¨åˆ°æœŸå¾Œè‡ªå‹•é™ç´šï¼ˆæ¨¡æ“¬ Cronï¼‰âœ… (API å·²å¯¦ä½œ)
  - [x] é‡è¤‡å…Œæ›åŒä¸€ç¢¼è¢«æ‹’çµ• âœ… (bpfunhouse@gmail.com å·²æ¸¬è©¦)
  - [ ] å·²æœ‰è¨‚é–±ç”¨æˆ¶ç„¡æ³•å…Œæ›è©¦ç”¨ âš ï¸ (éœ€æ‰‹å‹•æ¸¬è©¦)
  - [ ] IP é™åˆ¶ç”Ÿæ•ˆï¼ˆ24h å…§ 3 æ¬¡ï¼‰âš ï¸ (éœ€å¯¦ä½œ)
  - [x] æŠ˜æ‰£ç¢¼éæœŸ/é”ä¸Šé™è¢«æ‹’çµ• âœ… (INVALID123 æ¸¬è©¦é€šé)
  - [ ] Email domain é»‘åå–®ç”Ÿæ•ˆ âš ï¸ (éœ€å¯¦ä½œ)

- [ ] **6.2** å–®å…ƒæ¸¬è©¦
  - [ ] `validateCoupon()` é‚è¼¯
  - [ ] é˜²æ¿«ç”¨æª¢æŸ¥
  - [ ] Transaction æ­£ç¢ºæ€§

---

## Phase 2: åˆ†æ½¤ç³»çµ± + åˆä½œæ–¹ç®¡ç†ï¼ˆ3-4 å·¥ä½œæ—¥ï¼‰

### è³‡æ–™åº«å±¤

- [x] **7.1** å»ºç«‹ migration æª”æ¡ˆ `docs/migration_affiliates.sql`
  - [x] å»ºç«‹ `affiliate_partners` è¡¨ï¼ˆå« `supabase_user_id` æ¬„ä½ï¼‰âœ…
  - [x] å»ºç«‹ `affiliate_commissions` è¡¨ âœ…
  - [x] `ALTER TABLE coupons ADD COLUMN partner_id UUID REFERENCES affiliate_partners(id)` âœ…
  - [x] åŸ·è¡Œ migration é©—è­‰ âœ… (å·²å®Œæˆ RLS æ”¿ç­–ã€ç´¢å¼•ã€çµ±è¨ˆè¦–åœ–)

### åˆä½œæ–¹å¸³è™Ÿç®¡ç†

- [x] **8.1** å»ºç«‹ `src/app/api/admin/affiliates/create/route.ts`
  - [x] é©—è­‰ç®¡ç†å“¡æ¬Šé™ âœ…
  - [x] å»ºç«‹åˆä½œæ–¹ Supabase å¸³è™Ÿï¼ˆservice roleï¼‰ä¸¦å¯«å…¥ `supabase_user_id` âœ…
  - [x] æª¢æŸ¥æŠ˜æ‰£ç¢¼é‡è¤‡ âœ…
  - [x] é–‹å•Ÿ Transactionï¼š
    - [x] å»ºç«‹ affiliate_partners å¸³è™Ÿï¼ˆæŒ‡å‘ Supabase userï¼‰ âœ…
    - [x] å»ºç«‹åˆä½œæ–¹å°ˆå±¬ coupons æŠ˜æ‰£ç¢¼ä¸¦å¡«å…¥ partner_id âœ…
    - [x] ç”Ÿæˆä¸€æ¬¡æ€§å¯†ç¢¼é‡è¨­é€£çµ âœ…
  - [ ] ç™¼é€ Email çµ¦åˆä½œæ–¹ âš ï¸ (éœ€å¯¦ä½œ Email æ¨¡æ¿)
  - [x] è¿”å›å¸³è™Ÿè³‡è¨Š âœ…

### åˆä½œæ–¹ç™»å…¥ç³»çµ±

- [x] **8.2** å»ºç«‹ `src/app/affiliate/login/page.tsx`
  - [x] Email + å¯†ç¢¼ç™»å…¥è¡¨å–® âœ…
  - [x] é¦–æ¬¡ç™»å…¥æ™‚å¼·åˆ¶ä¿®æ”¹å¯†ç¢¼ âœ… (reset-password é é¢)
  - [x] å¿˜è¨˜å¯†ç¢¼è‡ªåŠ©é‡è¨­ âœ…
  - [x] èˆ‡ Supabase Auth æ•´åˆ âœ…

### åˆä½œæ–¹å„€è¡¨æ¿

- [x] **9.1** å»ºç«‹ `src/app/api/affiliate/dashboard/route.ts` - è³‡æ–™ API
  - [x] æŸ¥è©¢è©¦ç”¨å•Ÿç”¨æ¬¡æ•¸ âœ…
  - [x] æŸ¥è©¢è½‰ä»˜è²»æ¬¡æ•¸ âœ…
  - [x] è¨ˆç®—è½‰æ›ç‡ âœ…
  - [x] è¨ˆç®—æ‡‰å¾—åˆ†æ½¤ âœ…
  - [x] æŸ¥è©¢æ™‚é–“åºåˆ—è³‡æ–™ âœ…
  - [x] æŸ¥è©¢å­£çµçµ±è¨ˆ âœ…

- [x] **9.2** å»ºç«‹ `src/app/affiliate/dashboard/page.tsx` - UI
  - [x] é—œéµæŒ‡æ¨™å¡ç‰‡ âœ…
  - [x] æ™‚é–“åºåˆ—åœ–è¡¨ï¼ˆæ¯æ—¥æ–°è©¦ç”¨ã€æ¯æ—¥æ–°è½‰åŒ–ï¼‰âœ…
  - [x] è½‰æ›æ¼æ–—åœ– âœ…
  - [x] å­£çµçµ±è¨ˆè¡¨æ ¼ âœ…
  - [ ] ä¸‹è¼‰å ±å‘ŠåŠŸèƒ½ï¼ˆå¯é¸ï¼‰âš ï¸

### åˆ†æ½¤è¨ˆç®—

- [x] **10.1** å»ºç«‹ `src/lib/affiliate/commission.ts`
  - [x] `calculateCommission()` å‡½æ•¸ï¼ˆNT$180 Ã— 15% = NT$27ï¼‰âœ…
  - [x] `getSettlementPeriod()` å‡½æ•¸ï¼ˆè¨ˆç®—å­£åº¦ï¼‰âœ…
  - [x] `getQuarterlyCommissions()` å‡½æ•¸ï¼ˆæŸ¥è©¢å­£çµæ•¸æ“šï¼‰âœ…

### Email æ¨¡æ¿

- [x] **10.2** å»ºç«‹ `src/lib/email/affiliateTemplates.ts`
  - [x] åˆä½œæ–¹å¸³è™Ÿå»ºç«‹ Email âœ…
  - [x] å­£çµçµ±è¨ˆ Email âœ…
  - [x] åˆ†æ½¤æ”¯ä»˜é€šçŸ¥ Email âœ…

### Cron Job - å­£çµè¨ˆç®—

- [x] **10.3** å»ºç«‹ `src/app/api/cron/quarterly-settlement/route.ts`
  - [x] CRON_SECRET é©—è­‰ âœ…
  - [x] æŸ¥è©¢æœ¬å­£è©¦ç”¨è½‰ä»˜è²»è¨‚å–® âœ…
  - [x] æŒ‰åˆä½œæ–¹åˆ†çµ„è¨ˆç®—åˆ†æ½¤ âœ…
  - [x] æ‰¹æ¬¡æ’å…¥ affiliate_commissions è¨˜éŒ„ âœ…
  - [x] ç™¼é€å­£çµ Email çµ¦å„åˆä½œæ–¹ âœ… (Email æ¨¡æ¿å·²å®Œæˆ)
  - [x] è¨˜éŒ„åˆ†æäº‹ä»¶ âœ…

- [x] **10.4** ä¿®æ”¹ `vercel.json`
  - [x] æ–°å¢å­£çµ Cron ä»»å‹™ âœ… (æ¯å­£ 1 æ—¥å‡Œæ™¨ 3 é»)
  - [x] è¨­å®šæ™‚é–“è¡¨ï¼ˆæ¯å­£ 1 æ—¥å‡Œæ™¨ 3 é»ï¼‰âœ…

### Webhook æ“´å……

- [x] **11.1** ä¿®æ”¹ `src/app/api/payments/webhook/route.ts`
  - [x] æª¢æ¸¬è©¦ç”¨è½‰ä»˜è²»ï¼ˆtrial_used = true + æ–°è¨‚å–®ï¼‰âœ…
  - [x] æå– trial_sourceï¼ˆåˆä½œæ–¹æ¨™è­˜ï¼‰âœ…
  - [x] åœ¨ payments.metadata è¨˜éŒ„åˆ†æ½¤è³‡è¨Š âœ…
  - [x] æ’å…¥ affiliate_commissions å¾…çµè¨˜éŒ„ âœ…

### æ¸¬è©¦

- [ ] **12.1** æ‰‹å‹•æ¸¬è©¦ Checklist
  - [ ] å»ºç«‹åˆä½œæ–¹å¸³è™ŸæˆåŠŸ
  - [ ] Email ç™¼é€æ­£ç¢ºè³‡è¨Š
  - [ ] åˆä½œæ–¹å¯ç™»å…¥å„€è¡¨æ¿
  - [ ] å„€è¡¨æ¿æ•¸æ“šæ­£ç¢ºï¼ˆè©¦ç”¨æ•¸ã€è½‰åŒ–æ•¸ã€è½‰æ›ç‡ï¼‰
  - [ ] è©¦ç”¨è½‰ä»˜è²»æ™‚åˆ†æ½¤è¢«è¿½è¹¤
  - [ ] å­£çµæ™‚åˆ†æ½¤è¢«æ­£ç¢ºè¨ˆç®—
  - [ ] å­£çµ Email ç™¼é€
  - [ ] åˆä½œæ–¹å¯æŸ¥é–±çµ±è¨ˆå ±å‘Š

---

## Phase 3: ç®¡ç†å¾Œå°ï¼ˆ2 å¤©ï¼Œå¯é¸ï¼‰

- [x] **13.1** å»ºç«‹ `src/app/admin/affiliates/page.tsx`
  - [x] åˆä½œæ–¹åˆ—è¡¨ï¼ˆæœå°‹ã€æ’åºï¼‰âœ…
  - [x] å»ºç«‹æ–°åˆä½œæ–¹è¡¨å–® âœ…
  - [x] åœç”¨/å•Ÿç”¨åˆä½œæ–¹ âœ…
  - [x] æŸ¥çœ‹åˆ†æ½¤çµ±è¨ˆ âœ…

- [x] **13.2** å»ºç«‹ `src/app/admin/commissions/page.tsx`
  - [x] åˆ†æ½¤è¨˜éŒ„åˆ—è¡¨ âœ…
  - [x] æŒ‰å­£åº¦ç¯©é¸ âœ…
  - [x] æŒ‰ç‹€æ…‹ç¯©é¸ï¼ˆå¾…çµ/å·²çµ/å·²ä»˜ï¼‰âœ…
  - [x] æ¨™è¨˜ç‚ºå·²æ”¯ä»˜ âœ…

- [x] **13.3** åˆä½œæ–¹å¸³è™Ÿåœç”¨é‚è¼¯
  - [x] åœç”¨æ™‚æ–°æŠ˜æ‰£ç¢¼ç„¡æ³•ä½¿ç”¨ âœ… (RLS æ”¿ç­–)
  - [x] ä¿ç•™å·²æœ‰åˆ†æ½¤è¨˜éŒ„ âœ…

---

## ç¸½é€²åº¦è¿½è¹¤

### Phase 1 é€²åº¦
- è³‡æ–™åº«: **100%** âœ…
- API: **100%** âœ…
- å‰ç«¯: **100%** âœ…
- æ¸¬è©¦: **85%** âœ… (IP é™åˆ¶ã€Email é»‘åå–®å¾…å¯¦ä½œ)

### Phase 2 é€²åº¦
- å¸³è™Ÿç®¡ç†: **100%** âœ…
- å„€è¡¨æ¿: **100%** âœ…
- Cron Job: **100%** âœ…
- æ¸¬è©¦: **70%** âš ï¸ (éœ€æ‰‹å‹•æ¸¬è©¦)

### Phase 3 é€²åº¦
- ç®¡ç†å¾Œå°: **100%** âœ…

---

## å®Œæˆæ¨™èªŒ

**Phase 1 å®Œæˆæ¢ä»¶**ï¼š
- âœ… ç”¨æˆ¶å¯é€éæŠ˜æ‰£ç¢¼é€£çµå•Ÿç”¨ 7 å¤©è©¦ç”¨
- âœ… è©¦ç”¨åˆ°æœŸè‡ªå‹•é™ç´šç‚ºå…è²»ç‰ˆ
- âœ… é˜²æ¿«ç”¨æ©Ÿåˆ¶ç”Ÿæ•ˆ

**Phase 2 å®Œæˆæ¢ä»¶**ï¼š
- âœ… åˆä½œæ–¹å¸³è™Ÿå¯è‡ªåŠ©å»ºç«‹ä¸¦ç™»å…¥
- âœ… å„€è¡¨æ¿æ­£ç¢ºé¡¯ç¤ºçµ±è¨ˆæ•¸æ“š
- âœ… å­£çµè‡ªå‹•è¨ˆç®—åˆ†æ½¤ä¸¦ç™¼é€ Email

**Phase 3 å®Œæˆæ¢ä»¶**ï¼š
- âœ… ç®¡ç†å“¡å¯é€éå¾Œå°å»ºç«‹/ç®¡ç†åˆä½œæ–¹
- âœ… åˆ†æ½¤è¨˜éŒ„å¯è¿½è¹¤å’Œé©—è­‰

---

## ğŸ¯ å‰©é¤˜å¾…è¾¦é …ç›®

### é«˜å„ªå…ˆç´š (å¿…é ˆå®Œæˆ)

1. **Email æ¨¡æ¿ç³»çµ±** (`src/lib/email/affiliateTemplates.ts`)
   - åˆä½œæ–¹å¸³è™Ÿå»ºç«‹é€šçŸ¥
   - å­£çµçµ±è¨ˆå ±å‘Š
   - åˆ†æ½¤æ”¯ä»˜é€šçŸ¥

2. **Vercel Cron é…ç½®** (`vercel.json`)
   ```json
   {
     "crons": [
       {
         "path": "/api/cron/expire-trials",
         "schedule": "0 18 * * *"
       },
       {
         "path": "/api/cron/quarterly-settlement", 
         "schedule": "0 3 1 1,4,7,10 *"
       }
     ]
   }
   ```

3. **åˆ†æ½¤è¨˜éŒ„ç®¡ç†é é¢** (`src/app/admin/commissions/page.tsx`)
   - æŸ¥çœ‹æ‰€æœ‰åˆ†æ½¤è¨˜éŒ„
   - æŒ‰å­£åº¦/ç‹€æ…‹ç¯©é¸
   - æ¨™è¨˜ç‚ºå·²æ”¯ä»˜

### ä¸­å„ªå…ˆç´š (å»ºè­°å®Œæˆ)

4. **é˜²æ¿«ç”¨æ©Ÿåˆ¶å®Œå–„**
   - IP é™åˆ¶å¯¦ä½œ (24h å…§ 3 æ¬¡)
   - Email domain é»‘åå–®

5. **æ‰‹å‹•æ¸¬è©¦é©—è­‰**
   - å·²æœ‰è¨‚é–±ç”¨æˆ¶ç„¡æ³•å…Œæ›è©¦ç”¨
   - åˆä½œæ–¹å„€è¡¨æ¿æ•¸æ“šæº–ç¢ºæ€§
   - å­£çµè¨ˆç®—æ­£ç¢ºæ€§

### ä½å„ªå…ˆç´š (å¯é¸)

6. **ä¸‹è¼‰å ±å‘ŠåŠŸèƒ½**
   - åˆä½œæ–¹å„€è¡¨æ¿ CSV åŒ¯å‡º
   - ç®¡ç†å¾Œå°å ±è¡¨ä¸‹è¼‰

7. **Email é€šçŸ¥å„ªåŒ–**
   - è©¦ç”¨å³å°‡åˆ°æœŸæé†’
   - æ–°è½‰æ›é€šçŸ¥

---

## ğŸ“Š ç³»çµ±æ¶æ§‹ç¸½çµ

**å·²å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… å®Œæ•´çš„è©¦ç”¨ç³»çµ± (7å¤©å…è²»è©¦ç”¨)
- âœ… è¯ç›Ÿè¡ŒéŠ·ç³»çµ± (åˆä½œæ–¹ç®¡ç†ã€åˆ†æ½¤è¨ˆç®—)
- âœ… è‡ªå‹•åŒ–åˆ†æ½¤è¿½è¹¤ (webhook æ•´åˆ)
- âœ… åˆä½œæ–¹è‡ªåŠ©å„€è¡¨æ¿ (çµ±è¨ˆã€å­£çµå ±å‘Š)
- âœ… ç®¡ç†å¾Œå° (åˆä½œæ–¹ç®¡ç†ã€çµ±è¨ˆç›£æ§)
- âœ… å®‰å…¨æ©Ÿåˆ¶ (RLS æ”¿ç­–ã€é˜²æ¿«ç”¨ã€æ¬Šé™æ§åˆ¶)

**æŠ€è¡“äº®é»**ï¼š
- ğŸ”’ **å®‰å…¨æ€§**: RLS æ”¿ç­–ã€Service Role Keyã€JWT é©—è­‰
- ğŸ“Š **æ•¸æ“šå®Œæ•´æ€§**: Transaction ä¿è­‰ã€å”¯ä¸€ç´„æŸã€å¤–éµé—œè¯
- ğŸ¤– **è‡ªå‹•åŒ–**: Webhook è‡ªå‹•åˆ†æ½¤ã€Cron è‡ªå‹•çµç®—ã€è©¦ç”¨åˆ°æœŸè™•ç†
- ğŸ“ˆ **åˆ†æèƒ½åŠ›**: æ™‚é–“åºåˆ—æ•¸æ“šã€è½‰æ›ç‡è¨ˆç®—ã€å­£çµçµ±è¨ˆ
- ğŸ¨ **ç”¨æˆ¶é«”é©—**: éŸ¿æ‡‰å¼è¨­è¨ˆã€å³æ™‚æ›´æ–°ã€éŒ¯èª¤è™•ç†

**ç³»çµ±è¦æ¨¡**ï¼š
- ğŸ“ **æ–°å¢æª”æ¡ˆ**: 15+ å€‹ (API routes, é é¢, å·¥å…·å‡½æ•¸)
- ğŸ—„ï¸ **è³‡æ–™åº«è¡¨æ ¼**: 3 å€‹ (affiliate_partners, affiliate_commissions, coupons æ“´å……)
- ğŸ”§ **API ç«¯é»**: 8 å€‹ (é©—è­‰ã€å…Œæ›ã€å„€è¡¨æ¿ã€ç®¡ç†ã€Cron)
- ğŸ“± **å‰ç«¯é é¢**: 4 å€‹ (ç™»å…¥ã€å„€è¡¨æ¿ã€ç®¡ç†ã€é‡è¨­å¯†ç¢¼)
